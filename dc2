version: '3.1'

services: 

 db:
   build: ./db
   restart: always
   environment:
    POSTGRES_PASSWORD: 12345678
   expose:
     - 5432  

 javagw:
   build: ./javagw
   restart: always
   depends_on: 
     - db

 zabbix: 
   build: ./zabbix
   restart: always
   environment:
     DB_SERVER_HOST: db
     MYSQL_DATABASE: zabbix
     MYSQL_USER: zabbix
     MYSQL_PASSWORD: zabbix_pwd
     MYSQL_ROOT_PASSWORD: root_pwd
     ZBX_JAVAGATEWAY: zabbix-java-gateway
   ports:
     - 10051:10051
   depends_on: 
     - db
     - javagw

 web: 
  build: ./web
  restart: always
  environment:
     DB_SERVER_HOST: db
     MYSQL_DATABASE: zabbix
     MYSQL_USER: zabbix
     MYSQL_PASSWORD: zabbix_pwd
     MYSQL_ROOT_PASSWORD: root_pwd
  ports:
    - 89:80
  depends_on: 
    - db
    - javagw
    - zabbix
 
 adminer:
  build: ./adminer
  restart: always
  ports:
    - 6080:8080
